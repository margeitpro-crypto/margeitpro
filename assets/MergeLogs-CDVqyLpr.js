import{r as o,u as V,o as W,f as q,s as H,j as t,F as J}from"./ui-Cg0tFRDi.js";import{p as K,q as T}from"./index-D-kChlQ_.js";import{g as Q,a as X}from"./googleFileUtils-DmaHOIbQ.js";import"./vendor-Bzgz95E1.js";import"./firebase-DCRhkHpN.js";const E={slides:[{format:"pptx",label:"PowerPoint (.pptx)"},{format:"pdf",label:"PDF (.pdf)"},{format:"txt",label:"Text (.txt)"},{format:"jpeg",label:"JPEG image (.jpeg)"},{format:"png",label:"PNG image (.png)"},{format:"svg",label:"SVG (.svg)"}],docs:[{format:"docx",label:"Word (.docx)"},{format:"pdf",label:"PDF (.pdf)"},{format:"txt",label:"Text (.txt)"},{format:"html",label:"Web page (.html, zipped)"},{format:"epub",label:"EPUB (.epub)"}]},se=({setModal:x,user:d})=>{const[y,b]=o.useState([]),[F,j]=o.useState(!0),[i,w]=o.useState({search:"",type:"all",status:"all"}),[h,A]=o.useState({column:"sn",direction:"desc"}),[v,f]=o.useState(null),[a,g]=o.useState(new Set),N=o.useRef(null),P=o.useRef(null);o.useRef(null);const{refs:S,floatingStyles:R}=V({open:v!==null,onOpenChange:e=>{e||f(null)},placement:"bottom-end",middleware:[W(5),q(),H()]}),U=async()=>{j(!0);try{const e=(d==null?void 0:d.role)==="Admin"||d==null?void 0:d.email,r=await K(e);b(r)}catch(e){console.error("Error fetching merge logs:",e),b([])}finally{j(!1)}};o.useEffect(()=>{U()},[]),o.useEffect(()=>{const e=r=>{N.current&&!N.current.contains(r.target)&&f(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const z=e=>{A(r=>({column:e,direction:r.column===e&&r.direction==="asc"?"desc":"asc"}))},u=o.useMemo(()=>y.filter(e=>{const r=i.search.toLowerCase(),s=e.fileName.toLowerCase().includes(r)||e.sheet&&e.sheet.toLowerCase().includes(r)||e.user&&e.user.toLowerCase().includes(r),l=i.type==="all"||i.type==="slides"&&e.type==="Sheet to Slides"||i.type==="docs"&&e.type==="Sheet to Docs",n=i.status==="all"||e.status.toLowerCase()===i.status;return s&&l&&n}).sort((e,r)=>{const s=h.column,l=h.direction==="asc"?1:-1;let n=e[s],p=r[s];if(s==="timestamp"&&typeof n=="string"&&typeof p=="string"){const C=new Date(n).getTime(),D=new Date(p).getTime();if(!isNaN(C)&&!isNaN(D))return(C-D)*l}return n=n??"",p=p??"",n<p?-1*l:n>p?1*l:0}),[y,i,h]),_=e=>{if(e){const r=new Set(u.map(s=>s.id).filter(s=>s));g(r)}else g(new Set)},$=(e,r)=>{const s=new Set(a);r?s.add(e):s.delete(e),g(s)},k=u.length>0&&u.every(e=>e.id&&a.has(e.id)),I=a.size>0&&!k,M=(e,r)=>{v===r?f(null):(S.setReference(e.currentTarget),f(r))},m=()=>{f(null)},O=e=>{navigator.clipboard.writeText(e).then(()=>{alert("Link copied to clipboard!")}).catch(r=>{console.error("Failed to copy link: ",r),alert("Failed to copy link to clipboard.")}),m()},B=(e,r)=>{const s=Q(e);if(!s){console.warn("Invalid file URL format. Could not extract file information from:",e),alert("Invalid file URL format. Please check the URL and try again."),m();return}const l=X(s,r);if(!l){console.warn("Failed to generate download URL for file:",s.fileId,"format:",r),alert("Failed to generate download URL. Please try again."),m();return}window.open(l,"_blank"),m()},L=e=>{m(),x({type:"confirmation",props:{title:"Delete Log",message:`Are you sure you want to delete the log for <strong>${e.fileName}</strong>?`,onConfirm:async()=>{try{if(!e.id){alert("Error: This log cannot be deleted as it has no ID."),x({type:null,props:{}});return}await T(e.id),b(r=>r.filter(s=>s.sn!==e.sn)),g(r=>{const s=new Set(r);return s.delete(e.id),s})}catch(r){alert(`Error deleting log: ${r.message}`)}x({type:null,props:{}})}}})},G=()=>{const e=a.size;x({type:"confirmation",props:{title:"Delete Selected Logs",message:`Are you sure you want to delete <strong>${e}</strong> selected log${e>1?"s":""}?`,onConfirm:async()=>{try{const r=Array.from(a).map(s=>T(s));await Promise.all(r),b(s=>s.filter(l=>!l.id||!a.has(l.id))),g(new Set),alert(`Successfully deleted ${e} log${e>1?"s":""}.`)}catch(r){alert(`Error deleting logs: ${r.message}`)}x({type:null,props:{}})}}})},c=({column:e,label:r,className:s=""})=>t.jsx("th",{className:`py-3 px-4 font-semibold cursor-pointer ${s}`,onClick:()=>z(e),children:t.jsxs("div",{className:"flex items-center gap-1",children:[r,h.column===e&&t.jsx("span",{className:"material-icons-outlined text-sm",children:h.direction==="asc"?"arrow_upward":"arrow_downward"})]})});return t.jsxs("div",{ref:P,className:"card p-6 lg:p-8",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"material-icons-outlined text-3xl text-blue-600 dark:text-blue-500",children:"history_toggle_off"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Merge Logs"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1 text-base",children:"View, search, and manage the history of all merge operations."})]})]}),a.size>0&&t.jsxs("button",{onClick:G,className:"btn bg-red-600 hover:bg-red-700 text-white rounded-md px-4 py-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:a.size===0,children:[t.jsx("span",{className:"material-icons-outlined text-base mr-2",children:"delete"}),"Delete Selected (",a.size,")"]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[t.jsxs("div",{className:"input-with-icon flex-grow",children:[t.jsx("span",{className:"material-icons-outlined input-icon text-gray-400 dark:text-gray-500",children:"search"}),t.jsx("input",{type:"text",placeholder:"Search by file, sheet, or user...",onChange:e=>w(r=>({...r,search:e.target.value}))})]}),t.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[t.jsxs("select",{className:"p-2 w-full",onChange:e=>w(r=>({...r,type:e.target.value})),children:[t.jsx("option",{value:"all",children:"All Types"}),t.jsx("option",{value:"slides",children:"Sheet to Slides"}),t.jsx("option",{value:"docs",children:"Sheet to Docs"})]}),t.jsxs("select",{className:"p-2 w-full",onChange:e=>w(r=>({...r,status:e.target.value})),children:[t.jsx("option",{value:"all",children:"All Statuses"}),t.jsx("option",{value:"success",children:"Success"}),t.jsx("option",{value:"failed",children:"Failed"})]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left",children:[t.jsx("thead",{className:"border-b border-inherit text-gray-500 dark:text-gray-400 text-sm",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 font-semibold",children:t.jsx("input",{type:"checkbox",checked:k,ref:e=>{e&&(e.indeterminate=I)},onChange:e=>_(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),t.jsx(c,{column:"sn",label:"SN"}),t.jsx(c,{column:"fileName",label:"File Name"}),t.jsx(c,{column:"user",label:"User"}),t.jsx(c,{column:"type",label:"Type"}),t.jsx(c,{column:"operation",label:"Operation"}),t.jsx(c,{column:"status",label:"Status"}),t.jsx(c,{column:"timestamp",label:"Timestamp"}),t.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Actions"})]})}),t.jsx("tbody",{className:"text-sm",children:F?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"text-center py-8",children:t.jsx("div",{className:"spinner mx-auto"})})}):u.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"text-center py-8 text-gray-500",children:"No merge logs found."})}):u.map(e=>t.jsxs("tr",{className:"border-b last:border-b-0 transition-colors duration-200",style:{borderColor:"var(--fb-border)"},onMouseEnter:r=>r.currentTarget.style.backgroundColor="var(--fb-border)",onMouseLeave:r=>r.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{className:"py-4 px-4",children:t.jsx("input",{type:"checkbox",checked:e.id?a.has(e.id):!1,onChange:r=>e.id&&$(e.id,r.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),t.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:e.sn}),t.jsx("td",{className:"py-4 px-4 font-medium",style:{color:"var(--fb-text-primary)"},children:e.fileName}),t.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:e.user||"-"}),t.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:e.type}),t.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:e.operation||"-"}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("span",{className:`inline-block px-3 py-1 text-xs font-medium rounded-full transition-all duration-300 ${e.status==="Success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 success-animation":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 error-shake"}`,children:e.status})}),t.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:e.timestamp}),t.jsx("td",{className:"py-4 px-4 text-right",children:t.jsx("div",{className:"inline-block text-left",children:e.status==="Success"?t.jsxs("button",{onClick:r=>M(r,e.sn),className:`\r
                                                        relative group\r
                                                        material-icons-outlined rounded-full p-2 \r
                                                        transition-all duration-200 ease-out\r
                                                        hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50\r
                                                        dark:hover:bg-gradient-to-r dark:hover:from-indigo-900/20 dark:hover:to-purple-900/20\r
                                                        hover:shadow-md hover:scale-105\r
                                                        active:scale-95\r
                                                        focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2\r
                                                    `,style:{color:"var(--fb-text-secondary)"},onMouseEnter:r=>{r.currentTarget.style.color="var(--fb-primary)",r.currentTarget.style.transform="rotate(90deg)"},onMouseLeave:r=>{r.currentTarget.style.color="var(--fb-text-secondary)",r.currentTarget.style.transform="rotate(0deg)"},children:["more_vert",t.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 opacity-0 group-hover:opacity-10 transition-opacity duration-200"})]}):t.jsx("button",{onClick:()=>L(e),className:"material-icons-outlined p-1 transition-colors",style:{color:"var(--fb-text-secondary)"},onMouseEnter:r=>r.currentTarget.style.color="var(--fb-error)",onMouseLeave:r=>r.currentTarget.style.color="var(--fb-text-secondary)",children:"delete"})})})]},e.sn))})]})}),v&&(()=>{const e=y.find(r=>r.sn===v);return!e||!e.fileUrl?null:t.jsx(J,{children:t.jsx("div",{ref:S.setFloating,className:`\r
                                card w-80 z-50 p-3\r
                                shadow-2xl ring-1 ring-black/10 dark:ring-white/10\r
                                rounded-2xl overflow-hidden\r
                                backdrop-blur-sm\r
                                transition-all duration-200 ease-out\r
                                transform scale-100\r
                            `,style:{...R,animation:"fadeInScale 200ms cubic-bezier(0.4, 0, 0.2, 1)"},children:t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",onClick:m,className:`\r
                                        flex items-center gap-2 w-full px-3 py-2 text-left text-xs rounded-lg \r
                                        transition-all duration-200 ease-out group\r
                                        hover:bg-gradient-to-r hover:from-indigo-500 hover:to-purple-600 hover:text-white\r
                                        hover:shadow-sm\r
                                    `,style:{color:"var(--fb-text-primary)"},children:[t.jsx("span",{className:"material-icons-outlined text-sm text-blue-500 group-hover:text-white transition-all duration-200 group-hover:scale-110",children:"open_in_new"}),"Open"]}),t.jsxs("button",{onClick:()=>O(e.fileUrl),className:`\r
                                        flex items-center gap-2 w-full px-3 py-2 text-left text-xs rounded-lg \r
                                        transition-all duration-200 ease-out group\r
                                        hover:bg-gradient-to-r hover:from-indigo-500 hover:to-purple-600 hover:text-white\r
                                        hover:shadow-sm\r
                                    `,style:{color:"var(--fb-text-primary)"},children:[t.jsx("span",{className:"material-icons-outlined text-sm text-green-500 group-hover:text-white transition-all duration-200 group-hover:scale-110",children:"content_copy"}),"Copy Link"]}),t.jsxs("button",{onClick:()=>L(e),className:`\r
                                        flex items-center gap-2 w-full px-3 py-2 text-left text-xs rounded-lg \r
                                        transition-all duration-200 ease-out group\r
                                        hover:bg-gradient-to-r hover:from-red-500 hover:to-red-600 hover:text-white\r
                                        hover:shadow-sm\r
                                    `,style:{color:"var(--fb-error)"},children:[t.jsx("span",{className:"material-icons-outlined text-sm group-hover:text-white transition-all duration-200 group-hover:scale-110",children:"delete"}),"Delete"]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"px-3 pt-2 pb-1 text-xs font-semibold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-700/50 rounded-lg mb-1",children:"Download As"}),t.jsx("div",{className:"max-h-60 overflow-y-auto",children:(e.type==="Sheet to Slides"?E.slides:E.docs).map(r=>t.jsxs("button",{onClick:()=>B(e.fileUrl,r.format),className:`\r
                                                flex items-center gap-2 w-full px-3 py-2 text-left text-xs rounded-lg \r
                                                transition-all duration-200 ease-out group\r
                                                hover:bg-gradient-to-r hover:from-indigo-500 hover:to-purple-600 hover:text-white\r
                                                hover:shadow-sm\r
                                            `,style:{color:"var(--fb-text-primary)"},children:[t.jsx("span",{className:"material-icons-outlined text-sm text-gray-500 group-hover:text-white transition-all duration-200 group-hover:scale-110",children:"download"}),r.label]},r.format))})]})]})})})})(),t.jsxs("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:["Showing ",u.length," of ",y.length," merge logs. ",a.size>0&&`(${a.size} selected)`]})]})};export{se as default};
