import{r,j as e}from"./ui-Cg0tFRDi.js";import{C as u}from"./Chart-Cw_GaIrV.js";import{F as R,e as T}from"./index-D-kChlQ_.js";import"./vendor-Bzgz95E1.js";import"./firebase-DCRhkHpN.js";const n=({title:i,value:c,icon:d,iconColor:x})=>e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i}),e.jsx("span",{className:`material-icons-outlined ${x}`,children:d})]}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:c})]}),z=({theme:i})=>{var f;const[c,d]=r.useState([]),[x,y]=r.useState(!0),[h,b]=r.useState(null),[m,j]=r.useState(""),[p,N]=r.useState(""),[g,v]=r.useState(""),[a,S]=r.useState(null),[w,C]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const t=await R({});d(t);const l=await T();S(l)}catch{b("Failed to load data.")}finally{y(!1),C(!1)}})()},[]);const{apiUsageChartConfig:A,mergeStatusChartConfig:D,userActivityChartConfig:U}=r.useMemo(()=>{const s=i==="dark",t=s?"#334155":"#e2e8f0",l=s?"#94a3b8":"#64748B",o=s?"#f1f5f9":"#0f172a",E={type:"line",data:{labels:Array.from({length:30},(P,_)=>new Date(Date.now()-(29-_)*24*60*60*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})),datasets:[{label:"API Calls",data:(a==null?void 0:a.apiCallsLast30Days)||Array.from({length:30},()=>0),fill:!0,backgroundColor:"rgba(59, 130, 246, 0.1)",borderColor:"#3b82f6",pointBackgroundColor:"#3b82f6",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"API Calls (Last 30 Days)",color:o,font:{size:16}}},scales:{y:{grid:{color:t},border:{display:!1},ticks:{color:l}},x:{grid:{display:!1},ticks:{color:l,maxRotation:45,minRotation:45}}}}},k={type:"doughnut",data:{labels:["Successful","Failed"],datasets:[{data:a?[a.mergeStatus.success,a.mergeStatus.failed]:[0,0],backgroundColor:["#10b981","#ef4444"],borderColor:[s?"#0f172a":"#ffffff"],borderWidth:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:o}},title:{display:!0,text:"Merge Success vs. Failure",color:o,font:{size:16}}},cutout:"70%"}},L={type:"bar",data:{labels:["Admins","Users"],datasets:[{label:"Merges Performed",data:a?[a.userActivity.admins,a.userActivity.users]:[0,0],backgroundColor:["#8b5cf6","#3b82f6"],borderRadius:4,barPercentage:.5}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"User Activity by Role",color:o,font:{size:16}}},scales:{y:{beginAtZero:!0,grid:{color:t},border:{display:!1},ticks:{color:l}},x:{grid:{display:!1},ticks:{color:l}}}}};return{apiUsageChartConfig:E,mergeStatusChartConfig:k,userActivityChartConfig:L}},[i,a]);return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx("span",{className:"material-icons-outlined text-blue-600 dark:text-blue-500",children:"desktop_windows"}),"System Analytics"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1 text-base",children:"An in-depth look at system usage, performance, and user activity."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(n,{title:"Total API Calls (24h)",value:a?(((f=a.apiCallsLast30Days)==null?void 0:f.slice(-1)[0])||0).toLocaleString():"0",icon:"api",iconColor:"text-blue-500"}),e.jsx(n,{title:"Total Merges",value:a?a.totalMerges.toLocaleString():"0",icon:"merge",iconColor:"text-green-500"}),e.jsx(n,{title:"Error Rate (24h)",value:a?`${a.totalMerges>0?Math.round(a.mergeStatus.failed/a.totalMerges*100):0}%`:"0%",icon:"error_outline",iconColor:"text-red-500"}),e.jsx(n,{title:"Active Users",value:a?a.totalUsers.toLocaleString():"0",icon:"groups",iconColor:"text-purple-500"})]}),e.jsx("div",{className:"card p-6",children:e.jsx(u,{config:A,className:"h-96"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"card p-6 lg:col-span-1",children:e.jsx(u,{config:D,className:"h-80"})}),e.jsx("div",{className:"card p-6 lg:col-span-2",children:e.jsx(u,{config:U,className:"h-80"})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx("span",{className:"material-icons-outlined text-blue-600 dark:text-blue-500",children:"history"}),"Key Activities"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1 text-base",children:"Recent system activities including user actions, logins, merges, and more."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("select",{value:m,onChange:s=>j(s.target.value),className:"p-2 border border-gray-300 dark:border-gray-600 rounded",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"LOGIN_SUCCESS",children:"Login Success"}),e.jsx("option",{value:"LOGIN_FAILURE",children:"Login Failure"}),e.jsx("option",{value:"UPDATE_USER",children:"Update User"}),e.jsx("option",{value:"DELETE_USER",children:"Delete User"}),e.jsx("option",{value:"ADD_USER",children:"Add User"}),e.jsx("option",{value:"UPDATE_ROLE",children:"Update Role"}),e.jsx("option",{value:"UPDATE_STATUS",children:"Update Status"})]}),e.jsx("input",{type:"date",value:p,onChange:s=>N(s.target.value),className:"p-2 border border-gray-300 dark:border-gray-600 rounded",title:"Start Date"}),e.jsx("input",{type:"date",value:g,onChange:s=>v(s.target.value),className:"p-2 border border-gray-300 dark:border-gray-600 rounded",title:"End Date"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b border-inherit text-gray-500 dark:text-gray-400 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 font-semibold",children:"Action"}),e.jsx("th",{className:"py-3 px-4 font-semibold",children:"User"}),e.jsx("th",{className:"py-3 px-4 font-semibold",children:"Details"}),e.jsx("th",{className:"py-3 px-4 font-semibold",children:"Timestamp"}),e.jsx("th",{className:"py-3 px-4 font-semibold",children:"Status"})]})}),e.jsx("tbody",{className:"text-sm",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8",children:e.jsx("div",{className:"spinner mx-auto"})})}):h?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-red-500",children:h})}):(()=>{const s=c.filter(t=>!m||t.action===m).filter(t=>!p||new Date(t.timestamp)>=new Date(p)).filter(t=>!g||new Date(t.timestamp)<=new Date(g+"T23:59:59")).slice(0,20);return s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-gray-500",children:"No activities found."})}):s.map((t,l)=>e.jsxs("tr",{className:"border-b border-inherit last:border-b-0",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx("span",{className:"material-icons-outlined text-base text-gray-500",children:t.action==="LOGIN_SUCCESS"?"login":t.action==="LOGIN_FAILURE"?"no_accounts":t.action==="UPDATE_USER"?"manage_accounts":t.action==="DELETE_USER"?"person_remove":t.action==="ADD_USER"?"person_add":t.action==="UPDATE_ROLE"?"admin_panel_settings":t.action==="UPDATE_STATUS"?"toggle_on":"info"}),t.action.replace(/_/g," ")]})}),e.jsx("td",{className:"py-4 px-4 text-gray-500 dark:text-gray-400",children:t.userEmail}),e.jsx("td",{className:"py-4 px-4",children:t.details}),e.jsx("td",{className:"py-4 px-4 text-gray-500 dark:text-gray-400",children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-medium rounded-full ${t.status==="SUCCESS"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}`,children:t.status})})]},l))})()})]})})]})]})};export{z as default};
