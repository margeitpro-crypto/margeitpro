import{r as d,u as X,j as e,F as Y,o as Z,f as M,s as ee}from"./ui-Cg0tFRDi.js";import{r as te,i as se,j as re,k as ae,l as L,m as _}from"./index-DTZyYScH.js";import{g as oe,a as ne}from"./googleFileUtils-DmaHOIbQ.js";import"./vendor-Bzgz95E1.js";import"./firebase-DCRhkHpN.js";const k={spreadsheetId:"",sheetName:"Sheet1",startRow:"2",endRow:"",templateId:"",outputFileName:""},O={slides:[{format:"pptx",label:"PowerPoint (.pptx)"},{format:"pdf",label:"PDF (.pdf)"},{format:"txt",label:"Text (.txt)"}],docs:[{format:"docx",label:"Word (.docx)"},{format:"pdf",label:"PDF (.pdf)"},{format:"rtf",label:"RTF (.rtf)"},{format:"txt",label:"Text (.txt)"}]},g=({htmlFor:n,children:m})=>e.jsx("label",{htmlFor:n,className:"block text-sm font-medium mb-1",children:m}),le=n=>e.jsx("input",{...n,className:n.className||""});function ue({setModal:n,user:m}){const[p,F]=d.useState("slides"),[C,I]=d.useState(k),[S,D]=d.useState(k),[x,N]=d.useState([]),[u,j]=d.useState(!1),[b,U]=d.useState({column:"timestamp",direction:"desc"}),[v,y]=d.useState(null),R=d.useRef(null);d.useRef(null);const{refs:T,floatingStyles:A}=X({open:v!==null,onOpenChange:t=>{t||y(null)},middleware:[Z(5),M(),ee()]});d.useEffect(()=>{const t=s=>{R.current&&!R.current.contains(s.target)&&y(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const G=t=>{const{name:s,value:r}=t.target;I(a=>({...a,[s]:r}))},V=t=>{const{name:s,value:r}=t.target;D(a=>({...a,[s]:r}))},H=t=>{t==="slides"?I(k):D(k),N([])},P=async(t,s)=>{const r=s==="slides"?C:S;if(!r.spreadsheetId||!r.sheetName||!r.templateId){n({type:"confirmation",props:{title:"Validation Error",message:"Please fill in all required fields: Spreadsheet ID, Sheet Name, and Template ID.",confirmText:"Okay",confirmColor:"btn-primary",onConfirm:()=>n({type:null,props:{}})}});return}if(r.endRow&&parseInt(r.startRow)>parseInt(r.endRow)){n({type:"confirmation",props:{title:"Validation Error",message:"Start row cannot be greater than end row.",confirmText:"Okay",confirmColor:"btn-primary",onConfirm:()=>n({type:null,props:{}})}});return}j(!0),n({type:"progress",props:{title:"Processing Merge...",message:"Please wait, this may take a few moments. Large merges may take longer."}});try{const o=await(s==="slides"?re:ae)({...r,mode:s,runtype:t});if(o.error)throw new Error(o.error);if(!o.data||!o.data.urls||o.data.urls.length===0)throw new Error("Merge completed but no files were generated. Please check your template and data.");const l=o.data.urls.map((i,c)=>({sn:Date.now()+c,fileName:r.outputFileName?`${r.outputFileName} (${c+1})`:`Generated File ${c+1}`,fileUrl:i,type:s==="slides"?"Sheet to Slides":"Sheet to Docs",status:"Success",sheet:r.sheetName,timestamp:new Date().toLocaleString(),date:new Date().toISOString().split("T")[0],user:m==null?void 0:m.email,operation:t==="custom"?"Custom":"All In One",templateId:r.templateId}));try{for(const i of l)await L(i);try{await _({id:`merge_success_${Date.now()}`,icon:"check_circle",iconColor:"text-green-500",title:"Merge Complete",description:`Successfully merged "${r.outputFileName||"files"}" - ${l.length} file(s) created.`,timestamp:new Date().toLocaleString(),isNew:!0,priority:"Medium",category:"Merge Status"})}catch(i){console.warn("Failed to send success notification:",i)}}catch(i){console.warn("Failed to save merge log to Firebase:",i)}N(i=>[...l,...i])}catch(a){console.error("Merge failed",a);const o=a.message||"An unknown error occurred during the merge process. Please check your spreadsheet ID, template ID, and internet connection.";let l=o;o.includes("timeout")?l="Merge operation timed out. Please try again with fewer rows or check your internet connection.":o.includes("HTTP error")?l="Unable to connect to the merge service. Please check your internet connection and try again.":o.includes("network")&&(l="Network error occurred. Please check your internet connection and try again."),n({type:"confirmation",props:{title:"Merge Failed",message:l,confirmText:"Close",confirmColor:"btn-danger",onConfirm:()=>n({type:null,props:{}})}});const i={sn:Date.now(),fileName:r.outputFileName||"Untitled Merge",fileUrl:"",status:"Failed",type:s==="slides"?"Sheet to Slides":"Sheet to Docs",sheet:r.sheetName,timestamp:new Date().toLocaleString(),date:new Date().toISOString().split("T")[0],user:m==null?void 0:m.email,operation:t==="custom"?"Custom":"All In One",templateId:r.templateId};try{await L(i);try{await _({id:`merge_failed_${Date.now()}`,icon:"error",iconColor:"text-red-500",title:"Merge Failed",description:`Failed to merge "${r.outputFileName||"files"}": ${o}`,timestamp:new Date().toLocaleString(),isNew:!0,priority:"High",category:"Merge Status"})}catch(c){console.warn("Failed to send error notification:",c)}}catch(c){console.warn("Failed to save failed merge log to Firebase:",c)}N(c=>[i,...c])}finally{j(!1),n({type:null,props:{}})}},q=async t=>{const s=t==="slides"?C:S;if(!s.spreadsheetId||!s.sheetName||!s.templateId){n({type:"confirmation",props:{title:"Validation Error",message:"Please fill in all required fields: Spreadsheet ID, Sheet Name, and Template ID.",confirmText:"Okay",confirmColor:"btn-primary",onConfirm:()=>n({type:null,props:{}})}});return}if(s.endRow&&parseInt(s.startRow)>parseInt(s.endRow)){n({type:"confirmation",props:{title:"Validation Error",message:"Start row cannot be greater than end row.",confirmText:"Okay",confirmColor:"btn-primary",onConfirm:()=>n({type:null,props:{}})}});return}j(!0),n({type:"progress",props:{title:"Generating Preview...",message:"Please wait, this may take a few moments."}});try{const a=await(t==="slides"?te:se)({...s,mode:t});if(a.error)throw new Error(a.error);n({type:"preview",props:{title:`${t==="slides"?"Slides":"Docs"} Preview`,previewUrl:a.previewUrl,mode:t,formData:s,onClose:()=>n({type:null,props:{}})}})}catch(r){console.error("Preview failed",r);const a=r.message||"An unknown error occurred during the preview process.";n({type:"confirmation",props:{title:"Preview Failed",message:a,confirmText:"Close",confirmColor:"btn-danger",onConfirm:()=>n({type:null,props:{}})}})}finally{j(!1)}},B=(t,s)=>{v===s?y(null):(T.setReference(t.currentTarget),y(s))},f=()=>{y(null)},z=t=>{navigator.clipboard.writeText(t).then(()=>{alert("Link copied to clipboard!")}).catch(s=>{console.error("Failed to copy link: ",s),alert("Failed to copy link to clipboard.")}),f()},W=(t,s)=>{const r=oe(t);if(!r){console.warn("Invalid file URL format. Could not extract file information from:",t),alert("Invalid file URL format. Please check the URL and try again."),f();return}const a=ne(r,s);if(!a){console.warn("Failed to generate download URL for file:",r.fileId,"format:",s),alert("Failed to generate download URL. Please try again."),f();return}window.open(a,"_blank"),f()},$=t=>{N(s=>s.filter(r=>r.sn!==t)),f()},J=t=>{U(s=>({column:t,direction:s.column===t&&s.direction==="asc"?"desc":"asc"}))},K=d.useMemo(()=>[...x].sort((t,s)=>{const r=b.column,a=b.direction==="asc"?1:-1;let o=t[r],l=s[r];if(r==="timestamp"&&typeof o=="string"&&typeof l=="string"){const i=new Date(o).getTime(),c=new Date(l).getTime();if(!isNaN(i)&&!isNaN(c))return(i-c)*a}return o=o??"",l=l??"",o<l?-1*a:o>l?1*a:0}),[x,b]),h=(t,s,r,a,o,l,i,c="text",Q=!1)=>e.jsxs("div",{className:"input-with-icon",children:[e.jsx("span",{className:`material-icons-outlined input-icon ${s}`,children:t}),e.jsx(le,{id:r,type:c,name:a,placeholder:o,value:l,onChange:i,disabled:u,required:Q})]}),E=t=>{const s=t==="slides"?C:S,r=t==="slides"?G:V,a=t==="slides"?"slideshow":"article",o=t==="slides"?"text-yellow-500":"text-blue-500",l=`Google ${t==="slides"?"Slides":"Docs"} Template ID`;return e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-6 gap-y-5",children:[e.jsxs("div",{children:[e.jsxs(g,{htmlFor:`${t}-spreadsheetId`,children:["Data Spreadsheet ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),h("grid_on","text-green-500",`${t}-spreadsheetId`,"spreadsheetId","Spreadsheet ID",s.spreadsheetId,r,"text",!0)]}),e.jsxs("div",{children:[e.jsxs(g,{htmlFor:`${t}-sheetName`,children:["Data Sheet Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),h("view_list","text-green-500",`${t}-sheetName`,"sheetName","e.g., Sheet1",s.sheetName,r,"text",!0)]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:`${t}-startRow`,children:"Start Row"}),h("format_list_numbered","text-gray-400",`${t}-startRow`,"startRow","e.g., 2",s.startRow,r,"number")]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:`${t}-endRow`,children:"End Row (optional)"}),h("last_page","text-gray-400",`${t}-endRow`,"endRow","e.g., 50",s.endRow,r,"number")]}),e.jsxs("div",{children:[e.jsxs(g,{htmlFor:`${t}-templateId`,children:["Template ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),h(a,o,`${t}-templateId`,"templateId",l,s.templateId,r,"text",!0)]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:`${t}-outputFileName`,children:"Output File Name (Optional)"}),h("drive_file_rename_outline","text-gray-400",`${t}-outputFileName`,"outputFileName","e.g., Monthly_Report",s.outputFileName,r)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-8",children:[e.jsxs("button",{onClick:()=>q(t),disabled:u,className:"btn btn-secondary",children:[e.jsx("span",{className:"material-icons-outlined text-lg",children:"visibility"}),"Preview"]}),e.jsx("button",{onClick:()=>P("custom",t),disabled:u,className:"btn btn-secondary",children:"Custom (One file per row)"}),e.jsxs("button",{onClick:()=>P("allinone",t),disabled:u,className:"btn btn-primary",children:[e.jsx("span",{className:"material-icons-outlined text-lg",children:"auto_awesome"}),"All In One (One file for all)"]}),e.jsx("button",{onClick:()=>H(t),className:"btn btn-danger",disabled:u,children:"Clear"})]})]})},w=({column:t,label:s})=>e.jsx("th",{className:"py-3 px-4 font-semibold cursor-pointer",onClick:()=>J(t),children:e.jsxs("div",{className:"flex items-center gap-1",children:[s,b.column===t&&e.jsx("span",{className:"material-icons-outlined text-sm",children:b.direction==="asc"?"arrow_upward":"arrow_downward"})]})});return e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-icons-outlined text-3xl text-blue-600 dark:text-blue-500",children:"link"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Marge It"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-base",children:"Merge data from Google Sheets into Docs & Slides effortlessly."})]})]})}),e.jsxs("div",{className:"p-6 pt-0",children:[e.jsxs("div",{className:"p-1 rounded-lg flex",style:{backgroundColor:"var(--fb-border)"},children:[e.jsx("button",{onClick:()=>F("slides"),className:`flex-1 px-4 py-2 font-semibold text-sm rounded-md focus:outline-none transition-colors ${p==="slides"?"shadow-sm":""}`,style:{backgroundColor:p==="slides"?"var(--fb-surface)":"transparent",color:p==="slides"?"var(--fb-text-primary)":"var(--fb-text-secondary)"},children:"Sheet to Slides"}),e.jsx("button",{onClick:()=>F("docs"),className:`flex-1 px-4 py-2 font-semibold text-sm rounded-md focus:outline-none transition-colors ${p==="docs"?"shadow-sm":""}`,style:{backgroundColor:p==="docs"?"var(--fb-surface)":"transparent",color:p==="docs"?"var(--fb-text-primary)":"var(--fb-text-secondary)"},children:"Sheet to Docs"})]}),E(p==="slides"?"slides":"docs"),(u||x.length>0)&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-inherit w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Merge Results"}),u&&x.length===0&&e.jsx("div",{className:"min-h-[6rem] flex items-center justify-center",children:e.jsx("div",{className:"spinner"})}),x.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b border-inherit text-gray-500 dark:text-gray-400 text-sm",children:e.jsxs("tr",{children:[e.jsx(w,{column:"sn",label:"SN"}),e.jsx(w,{column:"fileName",label:"File Name"}),e.jsx(w,{column:"type",label:"Type"}),e.jsx(w,{column:"status",label:"Status"}),e.jsx(w,{column:"timestamp",label:"Timestamp"}),e.jsx("th",{className:"py-3 px-4 font-semibold text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"text-sm",children:K.map(t=>e.jsxs("tr",{className:"border-b last:border-b-0 transition-colors duration-200",style:{borderColor:"var(--fb-border)"},onMouseEnter:s=>s.currentTarget.style.backgroundColor="var(--fb-border)",onMouseLeave:s=>s.currentTarget.style.backgroundColor="transparent",children:[e.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:t.sn}),e.jsx("td",{className:"py-4 px-4 font-medium",style:{color:"var(--fb-text-primary)"},children:t.fileName}),e.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:t.type}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("span",{className:`inline-block px-3 py-1 text-xs font-medium rounded-full transition-all duration-300 ${t.status==="Success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 success-animation":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 error-shake"}`,children:t.status})}),e.jsx("td",{className:"py-4 px-4",style:{color:"var(--fb-text-secondary)"},children:t.timestamp}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("div",{className:"inline-block text-left",children:t.status==="Success"?e.jsx("button",{onClick:s=>B(s,t.sn),className:"material-icons-outlined rounded-full p-1 transition-colors",style:{color:"var(--fb-text-secondary)"},onMouseEnter:s=>s.currentTarget.style.backgroundColor="var(--fb-border)",onMouseLeave:s=>s.currentTarget.style.backgroundColor="transparent",children:"more_vert"}):e.jsx("button",{onClick:()=>$(t.sn),className:"material-icons-outlined p-1 transition-colors",style:{color:"var(--fb-text-secondary)"},onMouseEnter:s=>s.currentTarget.style.color="var(--fb-error)",onMouseLeave:s=>s.currentTarget.style.color="var(--fb-text-secondary)",children:"delete"})})})]},t.sn))})]})})]})]})]}),v&&(()=>{const t=x.find(s=>s.sn===v);return!t||!t.fileUrl?null:e.jsx(Y,{children:e.jsx("div",{ref:T.setFloating,className:"card w-56 z-50 p-2",style:A,children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsxs("a",{href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",onClick:f,className:"flex items-center gap-3 w-full px-3 py-2 text-left text-sm rounded-md transition-colors",style:{color:"var(--fb-text-primary)"},onMouseEnter:s=>s.currentTarget.style.backgroundColor="var(--fb-border)",onMouseLeave:s=>s.currentTarget.style.backgroundColor="transparent",children:[e.jsx("span",{className:"material-icons-outlined text-base text-blue-500",children:"open_in_new"}),"Open"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>z(t.fileUrl),className:"flex items-center gap-3 w-full px-3 py-2 text-left text-sm rounded-md transition-colors",style:{color:"var(--fb-text-primary)"},onMouseEnter:s=>s.currentTarget.style.backgroundColor="var(--fb-border)",onMouseLeave:s=>s.currentTarget.style.backgroundColor="transparent",children:[e.jsx("span",{className:"material-icons-outlined text-base text-green-500",children:"content_copy"}),"Copy Link"]})}),e.jsx("li",{className:"my-1 border-t border-inherit"}),e.jsx("li",{className:"px-3 pt-2 pb-1 text-xs text-gray-400",children:"Download As"}),(t.type==="Sheet to Slides"?O.slides:O.docs).map(s=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>W(t.fileUrl,s.format),className:"flex items-center gap-3 w-full px-3 py-2 text-left text-sm rounded-md transition-colors",style:{color:"var(--fb-text-primary)"},onMouseEnter:r=>r.currentTarget.style.backgroundColor="var(--fb-border)",onMouseLeave:r=>r.currentTarget.style.backgroundColor="transparent",children:[e.jsx("span",{className:"material-icons-outlined text-base text-gray-500",children:"download"}),s.label]})},s.format)),e.jsx("li",{className:"my-1 border-t border-inherit"}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>$(t.sn),className:"flex items-center gap-3 w-full px-3 py-2 text-left text-sm rounded-md transition-colors",style:{color:"var(--fb-error)"},onMouseEnter:s=>s.currentTarget.style.backgroundColor="rgba(228, 30, 63, 0.1)",onMouseLeave:s=>s.currentTarget.style.backgroundColor="transparent",children:[e.jsx("span",{className:"material-icons-outlined text-base",children:"delete"}),"Remove from list"]})})]})})})})()]})}export{ue as default};
